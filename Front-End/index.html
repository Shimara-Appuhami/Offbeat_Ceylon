<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Landing Page</title>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFpFDLrN4DPjDEXp7kKfGuooEL5tSheCk" async defer></script>

    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- Navigation Bar -->
<input type="checkbox" id="active">
<label for="active" class="menu-btn"><i class="fas fa-bars"></i></label>
<div class="wrapper">
    <ul>
        <li><a href="#">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Services</a></li>
        <li><a href="#">Gallery</a></li>
        <li><a href="#">Feedback</a></li>
        <li><a href="#">Contact</a></li>
        <li><a href="#">Register</a></li>
    </ul>
</div>

<!-- District Selection -->
<label for="districtSelect">Select District:</label>
<select name="district" id="districtSelect">
    <option value="">-- Select District --</option>
    <option value="Kandy">Kandy</option>
    <option value="Colombo">Colombo</option>
    <option value="Anuradhapura">Anuradhapura</option>
    <option value="Badulla">Badulla</option>
    <option value="Batticaloa">Batticaloa</option>
    <option value="Galle">Galle</option>
    <option value="Gampaha">Gampaha</option>
    <option value="Hambantota">Hambantota</option>
    <option value="Jaffna">Jaffna</option>
    <option value="Kalutara">Kalutara</option>
    <option value="Kegalle">Kegalle</option>
    <option value="Kilinochchi">Kilinochchi</option>
    <option value="Kurunegala">Kurunegala</option>
    <option value="Mannar">Mannar</option>
    <option value="Matale">Matale</option>
    <option value="Matara">Matara</option>
    <option value="Monaragala">Monaragala</option>
    <option value="Mullaitivu">Mullaitivu</option>
    <option value="Nuwara Eliya">Nuwara Eliya</option>
    <option value="Polonnaruwa">Polonnaruwa</option>
    <option value="Ampara">Ampara</option>
    <option value="Puttalam">Puttalam</option>
    <option value="Ratnapura">Ratnapura</option>
    <option value="Trincomalee">Trincomalee</option>
    <option value="Vavuniya">Vavuniya</option>
</select>


<!-- Search Bar -->
<div class="searchBox">
    <input class="searchInput" type="text" name="" placeholder="Search">
    <button class="searchButton">
        <i class="material-icons">
            <img id="img-search" src="assets/icon/icons8-search-50.png" alt="Search">
        </i>
    </button>
</div>

<!-- Add New Places & Category Buttons -->
<div class="button-group">
    <button class="shiny-cta" id="btn-add-place">
        <a href="add-places.html">+ Add Places</a><br>
    </button>
</div>
<div class="button-group">
    <button  id="btn-add-category">
        <a href="add-category-form.html">+ Add Category</a><br>
    </button>
</div>

<!--district cards-->
<div id="place-cards-container"></div>

<!-- Category Cards -->
<section class="hero-section">
    <div class="card-grid" id="category-cards">
        <!-- Cards will be dynamically added here -->
    </div>
</section>

<!-- Review Board -->
<div class="review-board">
    <h2>Customer Reviews</h2>

    <div class="review-card">
        <div class="review-content">
            <h3>John Doe</h3>
            <div class="stars">★★★★☆</div>
            <p>"Amazing service! Highly recommended for anyone looking for quality."</p>
        </div>
    </div>

    <div class="review-card">
        <div class="review-content">
            <h3>Jane Smith</h3>
            <div class="stars">★★★★★</div>
            <p>"Very professional and quick response. Will come back again for sure!"</p>
        </div>
    </div>

    <div class="review-card">
        <div class="review-content">
            <h3>Emily Johnson</h3>
            <div class="stars">★★★☆☆</div>
            <p>"Loved the experience. They are really supportive and friendly."</p>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="js/jquery-3.7.1.min.js"></script>
<script src="js/add-places.js"></script>
<script src="js/add-category.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

<script>
    $(document).ready(function () {
        function fetchCategories() {
            $.ajax({
                url: 'http://localhost:8081/api/v1/category/getAll',
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token'),
                    'category': 'category'
                },
                success: function (response) {
                    console.log("Categories fetched:", response);
                    const cardContainer = $('#category-cards');
                    cardContainer.empty();

                    if (!response || response.length === 0) {
                        cardContainer.append('<p>No categories available.</p>');
                        return;
                    }

                    response.forEach(category => {
                        const safeCategoryName = $('<div>').text(category.categoryName).html();
                        const imageFilename = category.categoryImage ? category.categoryImage.split("\\").pop() : "default.jpg";
                        const imageUrl = `http://localhost:8081/api/v1/uploads/${imageFilename}`;

                        cardContainer.append(`
                            <a class="card" href="#" data-category-id="${category.id}" data-category-name="${category.categoryName}">
                                <img src="${imageUrl}" class="card__background" alt="${safeCategoryName}">
                                <div class="card__content">
                                    <p class="card__category">${safeCategoryName}</p>
                                </div>
                            </a>
                        `);
                    });
                },
                error: function (xhr) {
                    console.error("Error fetching categories:", xhr.responseText);
                    $('#category-cards').empty().append('<p>Failed to load categories. Please try again later.</p>');
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("AJAX error:", textStatus, errorThrown);
            });
        }

        fetchCategories();

        // When a category card is clicked
        $('#category-cards').on('click', '.card', function () {
            const categoryId = $(this).data('category-id');
            const categoryName = $(this).data('category-name');

            // Fetch places related to the selected category
            $.ajax({
                url: `http://localhost:8081/api/v1/addPlace/getAllByCategory/${categoryName}`,
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                },
                success: function (response) {
                    console.log("Places fetched for category:", categoryName);
                    localStorage.setItem('categoryName',categoryName)

                    // Redirect to places page or update the UI with places
                    if (categoryName === "MOUNTAINS") {
                        window.location.href = "mountains.html";
                    }else if (categoryName === "WATERFALLS") {
                        window.location.href = "waterfalls.html";
                    }
                    // Update places on the page dynamically if needed
                },
                error: function (xhr) {
                    console.error("Error fetching places for category:", categoryId, xhr.responseText);
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("AJAX error:", textStatus, errorThrown);
            });
        });
    });
//     -------------------------------------------------------------------
    $(document).ready(function () {
        function getAllPlaces(district) {
            if (!district) {
                $('#place-cards-container').html('<p>Please select a district.</p>');
                return;
            }

            $.ajax({
                url: `http://localhost:8081/api/v1/addPlace/getAllByDistrict/${district}`,
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                },
                success: function (response) {
                    const container = $('#place-cards-container');
                    container.empty();

                    if (!response || response.length === 0) {
                        container.append('<p>No places available in this district.</p>');
                        return;
                    }

                    response.forEach((place, index) => {
                        const placeName = place.placeName || "Unknown Location";
                        const placeDescription = place.aboutPlace || "No description available.";
                        const imageFilename = place.images ? place.images.split("\\").pop() : "default.jpg";
                        const imageUrl = `http://localhost:8081/api/v1/uploads/${imageFilename}`;
                        const lat = parseFloat(place.latitude) || 7.8731;
                        const lng = parseFloat(place.longitude) || 80.7718;
                        const videoUrl = place.videoUrl ? extractYouTubeID(place.videoUrl) : null;
                        const status = place.status;

                        const cardHtml = `
                            <div class="cardd">
                                <div class="image-containerr">
                                    <img src="${imageUrl}" alt="${placeName}" />
                                </div>
                                <div class="contentt">
                                    <h3>${placeName}</h3>
                                    <p>${placeDescription}</p>
                                    <p><strong>Status:</strong> ${status}</p>
                                   <div class="map-sectionn">
                                        <div id="mapp"></div>
                                    </div>
                                    <div class="video-containerr">
                                        ${videoUrl ? `<iframe src="https://www.youtube.com/embed/${videoUrl}" frameborder="0" allowfullscreen></iframe>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;

                        container.append(cardHtml);
                        initMap(lat, lng, `map-${index}`);
                    });
                },
                error: function () {
                    $('#place-cards-container').append('<p>Failed to load places. Please try again later.</p>');
                }
            });
        }

        function initMap(lat, lng, mapId) {
            const position = { lat, lng };
            const map = new google.maps.Map(document.getElementById(mapId), {
                zoom: 10,
                center: position,
            });
            new google.maps.Marker({ position: position, map: map });
        }

        function extractYouTubeID(url) {
            const regex = /(?:youtube\.com\/.*[?&]v=|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : "";
        }

        // Trigger API call when a district is selected
        $('#districtSelect').change(function () {
            const selectedDistrict = $(this).val();
            getAllPlaces(selectedDistrict);
        });
    });
//     map


</script>

</body>
</html>
